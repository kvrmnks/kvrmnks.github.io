<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>用fft画画 - Kvrmnks's Blog</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Kvrmnks's Blog</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../about/" class="nav-link">About</a>
                            </li>
                            <li class="navitem">
                                <a href="../" class="nav-link">Blog</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>外面疫情严重,只能赋闲在家,闲着也是闲着,来学用fft画画吧</p>
<p><img alt="" src="1587643407396.jpg" /></p>
<!--more-->

<p>~~顺便预习一下马上要学的QT~~</p>
<p>### <strong>fft</strong></p>
<p>既然要用fft画画当然要会fft的呀,什么你还不会fft?</p>
<p><img alt="" src="1587643414466.png" /></p>
<p>如果你不会请去自己学  ~~其实有板子在会不会有什么区别呢~~  </p>
<p>这里丢个一直在用的fft板子  </p>
<p>复数类板子  </p>
<p>```cpp</p>
<p>class Complex{</p>
<p>private:</p>
<p>​    qreal a,b;</p>
<p>public:</p>
<p>​    Complex(qreal a=0,qreal b=0):a(a),b(b){}</p>
<p>​    Complex operator * (qreal x)const;</p>
<p>​    Complex operator * (const Complex &amp;y)const;</p>
<p>​    Complex operator + (const Complex &amp;y)const;</p>
<p>​    Complex operator - (const Complex &amp;y)const;</p>
<p>​    qreal length()const{</p>
<p>​        return sqrt(a<em>a+b</em>b);</p>
<p>​    }</p>
<p>​    qreal real()const{return a;}</p>
<p>​    qreal img()const{return b;}</p>
<p>};</p>
<p>Complex operator * (qreal x,Complex y);</p>
<p>Complex Complex::operator*(qreal x) const{</p>
<p>​    return Complex(this-&gt;a<em>x,this-&gt;b</em>x);</p>
<p>}</p>
<p>Complex Complex::operator*(const Complex &amp;y) const{</p>
<p>​    Complex ret(this-&gt;a<em>y.a-this-&gt;b</em>y.b,this-&gt;a<em>y.b+this-&gt;b</em>y.a);</p>
<p>​    return ret;</p>
<p>}</p>
<p>Complex Complex::operator+(const Complex &amp;y) const{</p>
<p>​    return Complex(this-&gt;a+y.a,this-&gt;b+y.b);</p>
<p>}</p>
<p>Complex Complex::operator-(const Complex &amp;y) const{</p>
<p>​    return Complex(this-&gt;a-y.a,this-&gt;b-y.b);</p>
<p>}</p>
<p>Complex operator * (qreal x,Complex y){</p>
<p>​    return y*x;</p>
<p>}</p>
<p>```</p>
<p>fft板子  </p>
<p>```cpp</p>
<p>void fft(QVector<Complex>&amp;data,int n){</p>
<p>​    QVector<int> rev(n);</p>
<p>​    int R = 0;</p>
<p>​    while((1&lt;&lt;(R+1))&lt;=n)R++;</p>
<p>​    for(int i=0;i<n;i++)rev[i]=(rev[i>&gt;1]&gt;&gt;1)|((i&amp;1)&lt;&lt;(R-1));</p>
<p>​    for(int i=0;i&lt;n;i++){</p>
<p>​        if(i&lt;rev[i])</p>
<p>​            std::swap(data[i],data[rev[i]]);</p>
<p>​    }</p>
<p>​    qreal pi = acos(-1);</p>
<p>​    for(int i=1;i&lt;n;i&lt;&lt;=1){</p>
<p>​        Complex w(cos(pi/i),sin(pi/i));</p>
<p>​        for(int j=0;j&lt;n;j+=(i&lt;&lt;1)){</p>
<p>​            Complex wn(1,0);</p>
<p>​            for(int k=0;k&lt;i;k++){</p>
<p>​                Complex x=data[j+k],y=wn*data[j+i+k];</p>
<p>​                data[j+k]=x+y;</p>
<p>​                data[i+j+k]=x-y;</p>
<p>​                wn=wn*w;</p>
<p>​            }</p>
<p>​        }</p>
<p>​    }</p>
<p>}</p>
<p>```</p>
<p>这里顺便说下绘图的原理,像是在做函数曲线一样,要描点连线  </p>
<p>也就是要求一开始要给我一个点列<script type="math/tex">A[i]=(x_i,y_i)</script>
</p>
<p>为了让它fft,需要把这个点列转化到复平面上<script type="math/tex">A[i]=x_i+y_i*i</script>
</p>
<p>顺便记点数为<script type="math/tex">n</script>
</p>
<p>然后就可以fft了呢  </p>
<p>假设生成的数列为<script type="math/tex">B[i]</script>
</p>
<p>那我们明显有</p>
<p>
<script type="math/tex; mode=display">A[j]=\frac{1}{n}*\sum_{k=0}^{k<n}B[k]*e^{\frac{2\pi ji}{n}*k}</script>
</p>
<p>因为每一项都是复数,所以我们可以把它对应到复平面上,这样<script type="math/tex">A[j]</script>就变成了一系列向量的和,有了明显的几何意义  </p>
<p>### <strong>QT</strong></p>
<p>##### <strong>安装</strong></p>
<p>请去清华镜像站下载安装包</p>
<p>##### <strong>用QT绘画</strong></p>
<p>好像有两种办法来着  </p>
<p>1.QPainter  </p>
<p>2.QGraphics  </p>
<p>第一种跟java swing那套理论差不多要自己重写绘图事件,鉴于之前就被swing恶心到了,而且这种方式一点都不OOP于是选了第二种  </p>
<p>第二种就是</p>
<p>一些基本的图形由QGraphicsItem继承得到  </p>
<p>要把这些图形丢到QGraphicsScene里,让它来做排版  </p>
<p>然后把QGraphicsScene丢给QGraphicsView让它显示出来就好了呢!  </p>
<p>具体的代码在下一节  </p>
<p>##### <strong>signal and slot</strong></p>
<p>这个是Qt里新的逻辑呢</p>
<p>简单的用法是</p>
<p>```cpp</p>
<p>QObject::connect(发出信号的对象地址,SIGNAL(信号函数),接受信号的对象地址,SLOT(槽函数));</p>
<p>```</p>
<p>一旦这样做了之后呢</p>
<p>发出信号的函数一旦发出了信号,接受信号的对象就会立即执行槽函数  </p>
<p>跟javafx里的property机制很像呢  </p>
<p>举个具体的例子吧  </p>
<p>```cpp</p>
<p>​    QApplication a(argc, argv);</p>
<p>​    QGraphicsScene *scene = new QGraphicsScene(0,0,1024,768);</p>
<p>​    QGraphicsView *view = new GraphicsView(scene);</p>
<p>​    QPushButton *button = new QPushButton("exit");</p>
<p>​    QObject::connect(button,SIGNAL(clicked()),&amp;a,SLOT(exit()));</p>
<p>​    view-&gt;addWidget(button);</p>
<p>​    view-&gt;show();</p>
<p>```</p>
<p>这样如果按钮被点击了,窗口就会被关闭了  </p>
<p>##### <strong>QTimeLine</strong></p>
<p>毕竟要做出来的是个动画  </p>
<p>当然要学学时间轴啦 ~~其实不会也没事呢~~  </p>
<p>下面是代码节选  </p>
<p>```cpp</p>
<p>QTimeLine *time = new QTimeLine(40000);</p>
<p>time-&gt;setFrameRange(0,1024);</p>
<p>QObject::connect(time,SIGNAL(frameChanged(int)),scene,SLOT(next()));</p>
<p>time-&gt;start();</p>
<p>```</p>
<p>第一个构造函数里面的参数是时间轴持续的时间,单位毫秒  </p>
<p>setFrameRange(int,int)  </p>
<p>第一个参数表示每帧耗时多少毫秒 如果填0的话默认每帧40毫秒  </p>
<p>第二个参数表示一共有多少帧  </p>
<p>注意如果进行着时间超出了一开始构造函数的时间,就停了,当然如果时间到了还没进行完,也会停  </p>
<p>那个next()是我定义的函数,作用是描下一个点  </p>
<p>到现在为止就已经可以完成整个动画了呢  </p>
<p><img alt="" src="1587643425697.jpg" /></p>
<p>### <strong>Qt打包</strong></p>
<p>当你做好了程序想要给小伙伴展示的时候怎么可能简简单单地丢给他们代码呢?  </p>
<p>qt打包的方法网上到处都是,我们来说说我犯过的坑吧  </p>
<p>##### <strong>提示无法定位到Q5Gui.dll类</strong></p>
<p>可能你的打包程序出了锅,你可以尝试ProcessExplorer然后把程序调用的dll自己挑过去</p>
<p>##### <strong>0x000000007b 大约长这样子~</strong></p>
<p>当你好不容易找全了dll,却发现了这么个错这是为啥呢  </p>
<p><img alt="" src="1587643431546.jpg" /></p>
<p>经过我漫长的调试,发现原因是我在qtcreator里编译是用的qt自带的gcc  </p>
<p>但是打包时我用的是dev里的cpp  </p>
<p>因为我原来在用gcc的时候把dev的gcc在环境变量里优先度提得太高了</p>
<p>于是打包的时候gcc自动用了dev的,导致版本不一致  </p>
<p>于是在环境变量设置里把qt的gcc优先度调到最高就好了呢  </p>
<p><img alt="" src="1587643436909.gif" /></p>
<p>### <strong>项目代码</strong></p>
<p>我放到github上了  </p>
<p><a href="https://github.com/kvrmnks/FFt-drawing">链接</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
